<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf8"/>
<title>traverse:场景中所有物体都执行</title>
</head>

<script type="text/javascript" src="../../js/jquery-1.7.1.js"></script>
<script type="text/javascript" src="../../js/three.js"></script>
<script type="text/javascript">
$(function(){
	var  version=THREE.REVISION;	
	$("#version").html(version);
})
</script>
<body>
当前版本：<span id="version"></span></br>
物体个数：<span id="counts"></span>
<div id="div1"></div>
</body>
<script type="text/javascript">
$(function(){
	initScene();//场景
	initThree();//渲染器
    initCamera();//相机
    //场景中添加元素
    var plane_obj=add_plane();//平面
	var cube_obj=add_cube();//立方体
	var sphere_obj=add_sphere();//球体
	var spollight_obj=add_spollight();//光源
	var axes=add_axes();//坐标
	$("#counts").html(scene.children.length);//获取元素个数
	//开始渲染
	$("#div1").append(renderer.domElement);
	//renderer.render(scene, camera);
    renders()
})

function renders(){
	scene.traverse(function(e){
			e.rotation.x+=0;
			e.rotation.y+=0;
			e.rotation.z+=0.01;
	});
	requestAnimationFrame(renders);
	renderer.render(scene, camera);
}

//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//场景
var scene;
function initScene() {
    scene = new THREE.Scene();
}
//渲染器
var renderer;
function initThree() {
	    renderer = new THREE.WebGLRenderer({
	        antialias : true
	    });
	 	// 设置渲染器的大小为窗口的内宽度，也就是内容区的宽度
	    renderer.setClearColor(0xeeeeee);
	    renderer.setSize(window.innerWidth, window.innerHeight);
	    renderer.shadowMapEnabled=true;//允许阴影
}
//照相机
var camera;
function initCamera() {
      camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 1, 10000);
    	//相机设置
        camera.position.x=-30;
		camera.position.y=40;
		camera.position.z=30;
		camera.lookAt(0,5,0);  
		//camera.lookAt(scene.position);
}

///&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&7
	//添加物体方法	
	//添加一条直线
	function add_line(){
		  //首先，我们声明了一个几何体geometry，如下：
		   var geometry = new THREE.Geometry();
		   //定义一种线条的材质
		   var material = new THREE.LineLambertMaterial( { vertexColors: THREE.VertexColors } );
		   //定义2个顶点的位置，并放到几何体geometry中
		    var p1 = new THREE.Vector3( -100, 0, 100 );
			var p2 = new THREE.Vector3( 100, 0, -100 );
			geometry.vertices.push(p1);
			geometry.vertices.push(p2);
			//为定义的2个顶点，设置不同的颜色，代码如下所示：
			var color1 = new THREE.Color( 0x444444 ),
				color2 = new THREE.Color( 0xFF0000 );
			geometry.colors.push( color1, color2 );
			//、定义一条线
			var line = new THREE.Line( geometry, material, THREE.LinePieces );
			//将线条放入场景中
			scene.add(line);
			return line;
	}
//添加一平面	
function add_plane(){
	var plane=new THREE.PlaneGeometry(60,40);
	var plane_mesh=new THREE.MeshLambertMaterial({color:0xffffff});
	var plane_obj=new THREE.Mesh(plane,plane_mesh);
	plane_obj.rotation.x=-0.5*Math.PI;
	plane_obj.position.x=15;
	plane_obj.position.y=0;
	plane_obj.position.z=0;
	plane_obj.receiveShadow=true;//接受阴影
	scene.add(plane_obj);
	return plane_obj;
}
//添加一个立方体：P
function add_cube(){
	var cube=new THREE.CubeGeometry(4,4,4);
	var cube_mesh=new THREE.MeshLambertMaterial({color:0xff0000});
	var cube_obj=new THREE.Mesh(cube,cube_mesh);
	cube_obj.position.x=-4;
	cube_obj.position.y=3;
	cube_obj.position.z=0;
	cube_obj.castShadow=true;//允许阴影
	scene.add(cube_obj);
	return cube_obj;
}
//添加一个球体
function add_sphere(){
	var sphere=new THREE.SphereGeometry(4,20,20);
	var sphere_mesh=new THREE.MeshLambertMaterial({color:0x7777ff});
	var sphere_obj=new THREE.Mesh(sphere,sphere_mesh);
	sphere_obj.position.x=16;
	sphere_obj.position.y=4;
	sphere_obj.position.z=0;
	sphere_obj.castShadow=true;//允许阴影
	scene.add(sphere_obj);
	return sphere_obj;
}
//场景中添加光源：
function add_spollight(){
	var spotlight=new THREE.SpotLight(0xffffff);
	spotlight.position.set(-40,60,-10);
	spotlight.castShadow=true;//允许阴影
	scene.add(spotlight);
	return spotlight;
}
//添加环境光：
function add_ambient(){
	var ambientLight=new THREE.AmbientLight(0x0c0c0c);
	scene.add(ambientLight);
}
//添加坐标
function add_axes(){
	var axes=new THREE.AxisHelper(20);
    scene.add(axes);
    return axes;
}
</script>
</html>