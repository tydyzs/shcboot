<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf8"/>
<title>聚光灯</title>
</head>

 <script type="text/javascript" src="../../js/jquery-1.7.1.js"></script>
<script type="text/javascript" src="../../js/three.js"></script>
<script type="text/javascript" src="../../js/SceneUtils.js"></script>
<script type="text/javascript" src="../../js/Stats.js"></script>
<script type="text/javascript" src="../../js/TrackballControls.js"></script>
<script type="text/javascript" src="../../js/dat.gui.js"></script>

<script type="text/javascript">
$(function(){
	var  version=THREE.REVISION;	
	$("#version").html(version);
})
</script>
<body>
<span id="version"></span>
<div id="div1"></div>
</body>
<script type="text/javascript">
//三大组件

var scene;//场景
var camera;//相机
var renderer;//渲染器
var axes;//坐标
//球形轨道控制器
var controls;
var stats;
var wuti_boj;//自定义物体
$(function(){
	 inits();//初始化组件
     add_plane();//平面
   //场景中添加元素
 	var cube_obj=add_cube();//立方体
 	var sphere_obj=add_sphere();//球体
 	var spollight_obj=add_spollight();//聚光灯
 	add_sphere_spollight();
 	var axes=add_axes();//坐标
     //自定义物体：
	 shc_start();//开始渲染
	 
})
//初始化组件：
function inits(){
	 //场景（所有图形存在的空间）
	 scene = new THREE.Scene();
	   // 透视相机
     camera = new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,0.1,1000);
     camera.position.set(-40,65,30);
     camera.lookAt(0,4,0);
	   // 渲染器
     renderer = new THREE.WebGLRenderer();
    // 设置渲染器的大小为窗口的内宽度，也就是内容区的宽度
    renderer.setClearColor(0xeeeeee);
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMapEnabled;
    renderer.shadowMapEnabled = true;
    //渲染器加入html
    $("#div1").append(renderer.domElement); 
    
    //添加坐标
    axes=new THREE.AxisHelper(20);
    scene.add(axes);
    //加入fps
	stats = new Stats();
    document.body.appendChild(stats.dom);
}      
function shc_start(){
	 //渲染
    renderer.render(scene, camera);
   // render()
}     
//动态函数
function animate(){
    controls.update();
    stats.update();
    wuti_boj.rotateY(0.01);  
    requestAnimationFrame(animate);
    renderer.render(scene,camera);

}
//动态函数
var invert = 0.5;
var phase = 0;
var controls = new function () {
    this.rotationSpeed = 0.03;
    this.bouncingSpeed = 0.03;
    this.ambientColor = "#0c0c0c";
    this.pointColor = "#0c0c0c";
    this.intensity = 1;
    this.distance = 100;
};
function render() {
    // move the light simulation
    if (phase > 2 * Math.PI) {
        invert = invert * -1;
        phase -= 2 * Math.PI;
    } else {
        phase += controls.rotationSpeed;
    }
    sphereLightMesh.position.z = +(7 * (Math.sin(phase)));
    sphereLightMesh.position.x = +(14 * (Math.cos(phase)));
    sphereLightMesh.position.y = 5;

    if (invert < 0) {
        var pivot = 14;
        sphereLightMesh.position.x = (invert * (sphereLightMesh.position.x - pivot)) + pivot;
    }

    pointLight.position.copy(sphereLightMesh.position);

    // render using requestAnimationFrame
    requestAnimationFrame(render);
    renderer.render(scene, camera);
}

///&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&7
//添加物体方法	
//添加一条直线
function add_line(){
	  //首先，我们声明了一个几何体geometry，如下：
	   var geometry = new THREE.Geometry();
	   //定义一种线条的材质
	   var material = new THREE.LineLambertMaterial( { vertexColors: THREE.VertexColors } );
	   //定义2个顶点的位置，并放到几何体geometry中
	    var p1 = new THREE.Vector3( -100, 0, 100 );
		var p2 = new THREE.Vector3( 100, 0, -100 );
		geometry.vertices.push(p1);
		geometry.vertices.push(p2);
		//为定义的2个顶点，设置不同的颜色，代码如下所示：
		var color1 = new THREE.Color( 0x444444 ),
			color2 = new THREE.Color( 0xFF0000 );
		geometry.colors.push( color1, color2 );
		//、定义一条线
		var line = new THREE.Line( geometry, material, THREE.LinePieces );
		//将线条放入场景中
		scene.add(line);
		return line;
}
//添加一平面	
function add_plane(){
	var plane=new THREE.PlaneGeometry(150,40);
	var plane_mesh=new THREE.MeshLambertMaterial({color:"#fff"});
	var plane_obj=new THREE.Mesh(plane,plane_mesh);
	plane_obj.rotation.x=-0.5*Math.PI;
	plane_obj.position.x=15;
	plane_obj.position.y=0;
	plane_obj.position.z=0;
	plane_obj.receiveShadow=true;//接受阴影
	scene.add(plane_obj);
	return plane_obj;
}
//添加一个立方体：P
function add_cube(){
	var cube=new THREE.CubeGeometry(4,4,4);
	var cube_mesh=new THREE.MeshLambertMaterial({color:"#f00"});
	var cube_obj=new THREE.Mesh(cube,cube_mesh);
	cube_obj.position.x=-4;
	cube_obj.position.y=3;
	cube_obj.position.z=0;
	cube_obj.castShadow=true;//允许阴影
	scene.add(cube_obj);
	return cube_obj;
}
//添加一个球体
function add_sphere(){
	var sphere=new THREE.SphereGeometry(4,20,20);
	var sphere_mesh=new THREE.MeshLambertMaterial({color:"#77f"});
	var sphere_obj=new THREE.Mesh(sphere,sphere_mesh);
	sphere_obj.position.x=16;
	sphere_obj.position.y=14;
	sphere_obj.position.z=0;
	sphere_obj.castShadow=true;//允许阴影
	scene.add(sphere_obj);
	return sphere_obj;
}
//添加一个光球
function add_sphere_spollight(){
	var sphere=new THREE.SphereGeometry(1,20,20);
	var sphere_mesh=new THREE.MeshLambertMaterial({color:"#fff"});
	var sphere_obj=new THREE.Mesh(sphere,sphere_mesh);
	sphere_obj.position.set(-10,10,-10);
	scene.add(sphere_obj);
}
//场景中添加光源：
function add_spollight(){
	var spotlight=new THREE.SpotLight("#fff",4.0,5000,1,0.01);
	spotlight.position.set(-10,10,-10);
	spotlight.castShadow=true;//允许阴影
	scene.add(spotlight);
	return spotlight;
}

//添加坐标
function add_axes(){
	var axes=new THREE.AxisHelper(20);
	scene.add(axes);
	return axes;
}
</script>
</html>