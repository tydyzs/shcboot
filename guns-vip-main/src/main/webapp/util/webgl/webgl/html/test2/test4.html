<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf8"/>
<title>鼠标键盘控制相机</title>
</head>
<script type="text/javascript" src="../../js/jquery2.1.4.min.js"></script>
<script type="text/javascript" src="../../js/three.js"></script>
<script type="text/javascript" src="../../js/TrackballControls.js"></script>
<script type="text/javascript" src="../../js/SceneUtils.js"></script>
<script type="text/javascript" src="../../js/Stats.js"></script>
<script type="text/javascript" src="../../js/dat.gui.js"></script>
<script type="text/javascript" src="test4.js"></script>

<script type="text/javascript">
$(function(){
	var  version=THREE.REVISION;	
	$("#version").html(version);
	
	 
})
</script>
<body>
	<div style="height:100%">
		<span id="version"></span>
		<div id="start" style="width:80px;height:80px"></div>
		<div>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<input id="console" type="text" value=""/>
		</div>
		<div id="div1"></div>
	</div>
</body>
<script type="text/javascript">
//三大组件

var scene;//场景
var camera;//相机
var renderer;//渲染器
var axes;//坐标
//球形轨道控制器
var controls;
var stats;
var wuti_obj;//自定义物体
$(function(){
	 inits();//初始化组件
	 add_spotlight()//光源
     add_plane();//平面
     add_cube();//添加立方体
     //自定义物体：
	 zidingyi();
	 shc_start();//开始渲染
	 keys.keyclick();//初始化键盘事件
	 mouse.mouseclick();//鼠标控制
})
//初始化组件：
function inits(){
	 //场景（所有图形存在的空间）
	 scene = new THREE.Scene();
	   // 透视相机
     camera = new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,0.1,1000);
     camera.position.set(0,300,300);
     camera.lookAt(0,0,0);
	   // 渲染器
     renderer = new THREE.WebGLRenderer();
    // 设置渲染器的大小为窗口的内宽度，也就是内容区的宽度
    renderer.setClearColor(0xeeeeee);
    renderer.setSize(1800, 700);
    renderer.shadowMapEnabled;
    renderer.shadowMapEnabled = true;
    //渲染器加入html
    $("#div1").append(renderer.domElement); 
    //添加坐标
    axes=new THREE.AxisHelper(20);
    scene.add(axes);
    //加入fps
	stats = new Stats();
    $("#start").html(stats.dom)
}      
function shc_start(){
    animate();
}     
function animate(){
    stats.update();
   //添加键盘动画(WASD：上下左右移动；shift：加速)
    keys.keydonghua1();
   //添加鼠标动画（鼠标上下左右移动）
   mouse.mousedonghua1();
   
    requestAnimationFrame(animate);
    renderer.render(scene,camera);
}
//添加光源
function add_spotlight(){
    //添加光线
     var spotlight = new THREE.SpotLight(0xffffff);
    var spotlightHelper = new THREE.SpotLightHelper(spotlight);
    spotlight.position.set(-50,100,2);
    spotlight.castShadow = true;
    spotlight.shadow.mapSize.width = 2000;  // default 默认512越大越细致消耗越多资源
    spotlight.shadow.mapSize.height = 2000; // default 默认512
    scene.add(spotlight);
    scene.add(spotlightHelper); 
    //添加环境光
    scene.add(new THREE.AmbientLight(0xffffff));
}
//添加一个立方体：P
function add_cube(){
	var cube=new THREE.CubeGeometry(60,60,60);
	var cube_mesh=new THREE.MeshLambertMaterial({color:0x660000});
	var cube_obj=new THREE.Mesh(cube,cube_mesh);
	cube_obj.position.x=-80;
	cube_obj.position.y=50;
	cube_obj.position.z=0;
	cube_obj.castShadow=true;//允许阴影
	scene.add(cube_obj);
	return cube_obj;
}
//添加一平面	
function add_plane(){
	var plane=new THREE.PlaneGeometry(400,160);
	var plane_mesh=new THREE.MeshLambertMaterial({color:0x002200});
	var plane_obj=new THREE.Mesh(plane,plane_mesh);
	plane_obj.rotation.x=-0.5*Math.PI;
	plane_obj.position.x=15;
	plane_obj.position.y=0;
	plane_obj.position.z=0;
	plane_obj.receiveShadow=true;//接受阴影
	scene.add(plane_obj);
	return plane_obj;
}		
function zidingyi(){
	//定义一组点
	var vertices=[
		new THREE.Vector3(0,10,0),
		new THREE.Vector3(0,10,10),
		new THREE.Vector3(0,20,0),
		new THREE.Vector3(10,10,0),
		new THREE.Vector3(10,20,0),
		new THREE.Vector3(0,20,10),
		new THREE.Vector3(10,10,10),
		new THREE.Vector3(10,20,10)
	];
	//定义一组面（从点数组中取点生产面：三点生产一面）
	var faces=[
		//1.每两个三角形组成一个平面(传入点数组下标，从0开始)
		//2.传入三个点顺序有规律，否则三角形无法绘制
		//（经研究规律与法向量有关：右手法则（右手四个手指绕点的顺序，大拇指的指向偏向于相机方位才能看到
		//简单说：从相机的角度三个点必须逆时针！！！！！
		//）
		new THREE.Face3(1,7,5)
		,new THREE.Face3(1,6,7)
	    ,new THREE.Face3(4,6,7)//
		,new THREE.Face3(4,3,6)
		,new THREE.Face3(0,4,2)//
		,new THREE.Face3(0,3,4)
		,new THREE.Face3(1,5,2)//
		,new THREE.Face3(1,2,0)
		,new THREE.Face3(2,5,7)//
		,new THREE.Face3(2,7,4)
		,new THREE.Face3(0,1,6)//
		,new THREE.Face3(0,6,3) 
	];
	
	var geom=new THREE.Geometry();//创建一个物体对象
	geom.vertices=vertices;
	geom.verticesNeedUpdate=true;
	geom.faces=faces;
	geom.computeFaceNormals();
	geom.computeVertexNormals();
	geom.mergeVertices();
	
	
	/* var caizhi1=new THREE.MeshBasicMaterial({opacity: 0.8,color:0x44e144,transparent:true});//创建一个基本材质（基础材质不会对光源产生效应）
  	 var caizhi2=new THREE.MeshLambertMaterial({color:0x7777ff});//可接受光源产生效果。
     var wuti_obj = new THREE.Mesh(geom,caizhi1);
  	  */
  	  
     var materials = [
        new THREE.MeshLambertMaterial({opacity: 0.8,color:0x44e144,transparent:true}),
        new THREE.MeshBasicMaterial({color:0x008800,wireframe:true}),
    ]; 
    wuti_obj = THREE.SceneUtils.createMultiMaterialObject(geom,materials);
    
    
    wuti_obj.name = '源';
    wuti_obj.children.forEach(function (e) {
        e.castShadow = true
    });
    renderer.shadowMap.enabled = true;
    //wuti_obj.position.set(0,-10,0);//设定位置
	scene.add(wuti_obj);
    
    //克隆物体
    //var wuti_obj2=wuti_obj.children[0].geometry.clone();
    var wuti_obj2=wuti_obj.clone();
    wuti_obj2.position.set(50,0,0);
    scene.add(wuti_obj2);
}	

</script>
</html>